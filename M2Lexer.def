(*!m2r10*) (* Copyright (c) 2015 B.Kowarsch. All rights reserved. *)

DEFINITION MODULE M2Lexer;

(* Lexer for Modula-2 R10 Bootstrap Compiler *)


IMPORT M2Symbol, Filename;


(* Lexer Type *)

TYPE Lexer = RECORD ( NIL )
    
  (* opaque context *)
  context : Context;

  (* method slots *)
  nextSym,
  consumeSym : PROCEDURE ( Lexer ) : M2Symbol;
  
  warnCount,
  errorCount : PROCEDURE ( Lexer ) : CARDINAL;
  status     : PROCEDURE ( Lexer ) : Status
  
END; (* Lexer *)


(* Lexer Context *)

TYPE Context = OPAQUE;


(* Lexer Status *)

TYPE Status =
  ( Success,
    AlreadyInitialised,
    UnableToAllocate,
    IllegalSymbolFound,
    UnescapedBackslash,
    IllegalCharInCharOrString,
    EndOfLineInCharOrString,
    LexemeCapacityExceded,
    CommentNestingLimitExceded,
    PrematureEndOfFile );


(* Constructor *)

PROCEDURE New ( VAR lexer : Lexer; filename : Filename; VAR s : Status );
(* Create newly allocated and initialised lexer instance associated with
   source file filename.  Passes back the status of the operation in s. *)

(* Mutator *)

PROCEDURE GetSym ( lexer : Lexer; VAR current, next : M2Symbol );
(* Passes back the current lookahead symbol in current and consumes it.
   Passes back the new lookahead symbol in next without consuming it. *)

(* Destructor *)

PROCEDURE Release ( VAR lexer : Lexer );
 (* Release lexer instance. Passes back NIL in lexer if successful. *)


(* Method Signatures *)

PROCEDURE consumeSym ( self : Lexer ) : M2Symbol;
(* Returns the current lookahead symbol and consumes it. *)

PROCEDURE lookaheadSym ( self : Lexer ) : M2Symbol;
(* Returns the current lookahead symbol without consuming it. *)

PROCEDURE warnCount ( self : Lexer ) : CARDINAL;
 (* Returns the lexer's accumulated warning count. *)

PROCEDURE errorCount ( self : Lexer ) : CARDINAL;
 (* Returns the lexer's accumulated error count. *)

PROCEDURE status ( self : Lexer ) : Status;
(* Returns the status of the last operation. *)


END M2Lexer.